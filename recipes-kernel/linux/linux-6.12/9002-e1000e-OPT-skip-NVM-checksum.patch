From bf6149b3a58439d6bd85f66c58493a68cf2b8bb6 Mon Sep 17 00:00:00 2001
From: Michael Shych <michaelsh@nvidia.com>
Date: Thu, 23 Mar 2023 17:59:25 +0000
Subject: [PATCH] e1000e: OPT: skip NVM checksum.

NVM checksum is reported as bad in many cases after full
BIOS SPI flash including GbE section burn by Dediprog.
This happened in the early steps of production flow before
EEPROM / NVM info will be customized and the checksum will
be recalculated. Just skip this check.

Signed-off-by: Michael Shych <michaelsh@nvidia.com>
---
 drivers/net/ethernet/intel/e1000e/netdev.c | 10 +++++++++-
 1 file changed, 9 insertions(+), 1 deletion(-)

diff --git a/drivers/net/ethernet/intel/e1000e/netdev.c b/drivers/net/ethernet/intel/e1000e/netdev.c
index 5fe54e9..e1420712 100644
--- a/drivers/net/ethernet/intel/e1000e/netdev.c
+++ b/drivers/net/ethernet/intel/e1000e/netdev.c
@@ -7377,7 +7377,7 @@ static int e1000_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 	u16 aspm_disable_flag = 0;
 	u16 eeprom_data = 0;
 	u16 eeprom_apme_mask = E1000_EEPROM_APME;
-	int bars, i, err;
+	int bars, err;
 	s32 ret_val = 0;
 
 	if (ei->flags2 & FLAG2_DISABLE_ASPM_L0S)
@@ -7573,6 +7573,12 @@ static int e1000_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 	/* systems with ASPM and others may see the checksum fail on the first
 	 * attempt. Let's give it a few tries
 	 */
+	/* NVIDIA >>>
+	 * NVM checksum is reported as bad in many cases after full
+	 * BIOS SPI flash including GbE section burn by Dediprog.
+	 * This happened in the early steps of production flow before
+	 * EEPROM / NVM info will be customized and the checksum will
+	 * be recalculated. Just skip this check.
 	for (i = 0;; i++) {
 		if (e1000_validate_nvm_checksum(&adapter->hw) >= 0)
 			break;
@@ -7582,6 +7588,8 @@ static int e1000_probe(struct pci_dev *pdev, const struct pci_device_id *ent)
 			goto err_eeprom;
 		}
 	}
+	 * NVIDIA <<<
+	 */
 
 	e1000_eeprom_checks(adapter);
 
-- 
2.8.4
