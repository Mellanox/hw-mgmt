From ef6ac2ab3251d3c8f0880d6672bef3374846b953 Mon Sep 17 00:00:00 2001
From: Vadim Pasternak <vadimp@nvidia.com>
Date: Mon, 28 Jun 2021 09:37:51 +0000
Subject: [PATCH backport/bringup 4.19 2/2] squash to: net: mlxsw: Extend mlxsw
 driver with bring-up fixes

Signed-off-by: Vadim Pasternak <vadimp@nvidia.com>
---
 drivers/net/ethernet/mellanox/mlxsw/core_env.c   | 2 +-
 drivers/net/ethernet/mellanox/mlxsw/core_hwmon.c | 9 ++++-----
 2 files changed, 5 insertions(+), 6 deletions(-)

diff --git a/drivers/net/ethernet/mellanox/mlxsw/core_env.c b/drivers/net/ethernet/mellanox/mlxsw/core_env.c
index 39111620f..faae6fe3c 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/core_env.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/core_env.c
@@ -348,7 +348,7 @@ int mlxsw_env_sensor_map_create(struct mlxsw_core *core,
 			map->sensor_bit_map[i++] = bit;
 	}
 
- 	return 0;
+	return 0;
 }
 EXPORT_SYMBOL(mlxsw_env_sensor_map_create);
 
diff --git a/drivers/net/ethernet/mellanox/mlxsw/core_hwmon.c b/drivers/net/ethernet/mellanox/mlxsw/core_hwmon.c
index 04ab383ca..55009dd50 100644
--- a/drivers/net/ethernet/mellanox/mlxsw/core_hwmon.c
+++ b/drivers/net/ethernet/mellanox/mlxsw/core_hwmon.c
@@ -371,14 +371,13 @@ mlxsw_hwmon_module_temp_label_show(struct device *dev,
 	struct mlxsw_hwmon_attr *mlxsw_hwmon_attr =
 			container_of(attr, struct mlxsw_hwmon_attr, dev_attr);
 	struct mlxsw_hwmon_dev *mlxsw_hwmon_dev;
+	int index = mlxsw_hwmon_attr->type_index;
 
 	mlxsw_hwmon_dev = mlxsw_hwmon_attr->mlxsw_hwmon_dev;
 	if (strlen(mlxsw_hwmon_dev->name))
-		return sprintf(buf, "%s front panel %03u\n", mlxsw_hwmon_dev->name,
-			       mlxsw_hwmon_attr->type_index);
-	else
-		return sprintf(buf, "front panel %03u\n",
-			       mlxsw_hwmon_attr->type_index);
+		index -= 1;
+
+	return sprintf(buf, "front panel %03u\n", index);
 }
 
 static ssize_t
-- 
2.20.1

